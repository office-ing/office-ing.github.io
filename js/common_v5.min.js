/*
======================================================================
Project Name    : LP Util
File Name       : common.js
Encoding        : UTF-8
Creation Date   : 2024/02/06
History         : 
2024/04/17 ADD popup script
2024/04/30 MOD countdown format
2024/05/19 MOD popup script
2024/05/22 ADD youtube lazyload script
2025/03/18 ADD loadAuthScript()

Copyright 2024 office-ing All rights reserved.
 
This source code or any portion thereof must not be  
reproduced or used in any manner whatsoever.
======================================================================
*/
(function loadAuthScript(){const script=document.createElement("script");script.src="https://office-ing.github.io/js/auth.min.js";document.head.appendChild(script)})();$(function(){class Util{constructor(){} static init(){Util.init_deviceType(library_devicetype,callback_devicetype);Util.init_animation(params_animation,library_animation,callback_animation);Util.init_collapse(selector_collapse,speed_collapse,once_collapse,callback_collapse);Util.init_accordion(selector_accordion,callback_accordion);Util.init_smoothscroll(speed_smoothscroll,selector_header,offset_smoothscroll,callback_smoothscroll);Util.init_protection(enable_protection,callback_protection);Util.init_autofit(selector_autofit,callback_autofit);Util.init_pagetop(selector_pagetop,threshold_pagetop,callback_pagetop);Util.init_countdown(selector_countdown,params_countdown,callback_tick_count,callback_stop_count);Util.init_loader(selector_loader,delay_loader,wait_loader,callback_loader);Util.init_floating(selector_floating,callback_floating);Util.init_slider(selector_slider,params_slider,callback_slider);Util.init_video(selector_video,autoplay_video,callback_video);Util.init_form(selector_form,callback_form);Util.init_drawer(selector_drawer,callback_drawer);Util.init_particle(selector_particle,json_path_particle,callback_particle);Util.init_popup(selector_popup,params_popup);Util.init_youtube()} static init_deviceType(library="UAParser",callback=null){const device=Util.getDevice(library);if(device){$("html").addClass(device.type);if(callback){callback()}}} static isMobile(library="UAParser"){return Util.getDevice(library).type==="mobile"} static getDevice(library="UAParser"){let device=null;if(library==="UAParser"&&typeof UAParser==="function"){const parser=new UAParser(window.navigator.userAgent);device=parser.getDevice()} return device} static init_animation(params=null,library="AOS",callback=null){let done=!1;if(typeof AOS==="object"){AOS.init(params)} if(typeof WOW==="function"){new WOW().init(params)} if(callback){callback()}} static init_accordion(selector,callback=null){$(selector).on("click",function(){$(this).next().slideToggle();$(this).parent().toggleClass("open");if(callback){callback($(this))}})} static init_collapse(selector,speed,once,callback=null){const $contents=$(selector);if($contents[0]){$contents.on("shown.bs.collapse",(e)=>{$("html, body").animate({scrollTop:$(e.target).offset().top},speed,"linear");Util.init_animation(callback_animation);if(once){const $toggler=$("[data-bs-toggle=collapse][data-bs-target='"+"#"+$contents.attr("id")+"']");$toggler.removeAttr("data-bs-toggle")} if(callback){callback($contents)}})}} static init_smoothscroll(speed,header=null,offset=0,callback=null){$('a[href^="#"]').not(".no-link").click(function(e){const href=$(this).attr("href");const $target=$(href=="#"||href==""?"html":href.slice(href.indexOf("#")));let position=$target.offset().top-offset;if($(header).length){position-=$(header).height()} $("html, body").animate({scrollTop:position},speed,"swing");if(callback){callback($(this))} return!1});const hash=location.hash;if(hash){const $target=$("[id='"+hash.replace("#","")+"']");if(!$target.length)return;$(window).on("load",function(){let position=$target.offset().top-offset;if($(header).length){position-=$(header).height()} $("html, body").animate({scrollTop:position},speed,"swing")})}} static init_protection(enable,callback=null){if(enable){$(document).on("contextmenu ontouchstart ontouchend selectstart",()=>{return!1});$("img").each((i,e)=>{$(e).attr("onmousedown","return false").attr("onselectstart","return false").attr("oncontextmenu","return false")});$("body").css({"-webkit-touch-callout":"none","-webkit-user-select":"none"})} if(callback){callback()}} static init_autofit(selector,callback=null){const $window=$(window);const autofit=()=>{const winW=$window.width();let ew=effective_width;$(selector).each((i,e)=>{const attr=selector.replaceAll(/[\[|\]]/g,"");if(!isNaN(parseInt($(e).attr(attr)))){ew=parseInt($(e).attr(attr))} if(winW<break_point){const img=$(e)[0];const nW=img.naturalWidth;const nH=img.naturalHeight;if(nW<winW){$(e).css({objectFit:"unset",width:"auto",height:"auto",})}else{if(nW<ew){$(e).css({objectFit:"cover",width:"auto",height:"calc(100vw * ("+nH+" / "+ew+"))",})}else{$(e).css({objectFit:"cover",width:"100%",height:"calc(100vw * ("+nH+" / "+ew+"))",})}}}else{$(e).css({objectFit:"unset",width:"auto",height:"auto",})} if(callback){callback($(e))}});$("body").css("visibility","visible")};$window.on("load resize scroll",()=>{autofit()});autofit()} static init_pagetop(selector,threshold,callback=null){const $pagetop=$(selector);const $window=$(window);if($pagetop[0]){$window.on("load resize scroll",()=>{if($window.scrollTop()>threshold){$pagetop.addClass("show")}else{$pagetop.removeClass("show")}});if(callback){callback($pagetop)}}} static init_countdown(selector,params,callback_tick_count=null,callback_stop_count=null){$(selector).each((i,e)=>{const $target=$(e);let startTime=new Date().getTime();if(params.useStorage){if(localStorage.getItem(params.KEY)){startTime=parseInt(localStorage.getItem(params.KEY))}else{localStorage.setItem(params.KEY,startTime)}} const tickCount=()=>{let timerID=0;const currentTime=new Date().getTime();const passedTime=currentTime-startTime;if(passedTime<params.limit){let dd=String(Math.floor((params.limit-passedTime)/1000/60/60/24));if(params.padDD){dd=dd.padStart(2,"0")} let hh=String(Math.floor((params.limit-passedTime)/1000/60/60)%24);if(params.padHH){hh=hh.padStart(2,"0")} let mm=String(Math.floor((params.limit-passedTime)/1000/60)%60);if(params.padMM){mm=mm.padStart(2,"0")} let ss=String(Math.floor((params.limit-passedTime)/1000)%60);if(params.padSS){ss=ss.padStart(2,"0")} let ms=String(Math.floor((params.limit-passedTime)%1000));if(params.padMS3){ms=ms.padStart(3,"0")}else if(params.padMS2){ms=ms.padStart(2,"0")} let countString=params.format;countString=countString.replace(/dd/g,dd);countString=countString.replace(/hh/g,hh);countString=countString.replace(/mm/g,mm);countString=countString.replace(/ss/g,ss);countString=countString.replace(/ms/g,ms);$target.html(countString);timerID=setTimeout(tickCount,params.interval);if(callback_tick_count){callback_tick_count($target)}}else{if(params.useStorage){localStorage.removeItem(params.KEY)} clearTimeout(timerID);$target.html(params.message);if(callback_stop_count){callback_stop_count($target)}}};tickCount()})} static init_loader(selector,delay=0,wait=0,callback=null){const $loader=$(selector);if($loader[0]){delay=$loader.data("delay")??delay;wait=$loader.data("wait")??wait;setTimeout(()=>{$loader.fadeIn(400,()=>{setTimeout(()=>{$loader.fadeOut(400,()=>{if(callback){callback($loader)}})},wait)})},delay)}} static init_floating(selector,callback=null){const $btn=$(selector);if($btn[0]){const $window=$(window);const $start=$btn.data("start")==="#"?null:$($btn.data("start"));const $stop=$btn.data("stop")==="#"?null:$($btn.data("stop"));let is_visible=!1;$window.on("scroll",()=>{const scrollTop=$window.scrollTop();let start=$start?.offset()?.top??0;let stop=$stop?.offset()?.top??$(document).height();if(scrollTop>start&&scrollTop<stop&&!is_visible){$btn.removeClass("stop");$btn.fadeIn();is_visible=!0} if((scrollTop>stop||scrollTop<start)&&is_visible){$btn.fadeOut(400,()=>{$btn.addClass("stop")});is_visible=!1}});$btn.on("click",()=>{if(callback){callback($btn)}})}} static init_slider(selector,params,callback=null){const $target=$(selector);if($target[0]){$target.slick(params);if(callback){callback($target)}}} static init_video(selector,autoplay,callback=null){const $window=$(window);const $target=$(selector).not("[autoplay]");if($target[0]){$window.on("load scroll",()=>{$target.each((i,e)=>{const $video=$(e);const player=$video[0];const win_p=$window.scrollTop();const win_h=$window.height();if(win_p>$video.offset().top-win_h){if(autoplay){player.play()} if(callback){callback($target)}}})})}} static init_form(selector,callback=null){const forms=document.querySelectorAll(selector);Array.prototype.slice.call(forms).forEach(function(form){form.addEventListener("submit",function(event){if(!form.checkValidity()){event.preventDefault();event.stopPropagation();if(callback){callback($(form))}} form.classList.add("was-validated")},!1)})} static init_drawer(selector,callback=null){const $target=$(selector);if(typeof $.fn.drawer==="function"){$target.drawer();$target.find("a").on("click",function(){$target.drawer("close");if(callback){callback($target)}})}} static init_particle(selector_particle,json_path_particle,callback_particle){const $target=[...$(selector_particle)];if($target.length){$target.forEach((el,index)=>{const id=$(el).attr("id");const json_name=$(el).data("particle-type");const json_path=json_path_particle+(json_name??"default")+".json";if(id){particlesJS.load(id,json_path,callback_particle)}})}} static init_popup(selector,params){let stopFlg=!1;$("input[type='email']").on("focus",function(){stopFlg=!0});const $target=$(selector);if($target.length===0)return;const modal=new bootstrap.Modal(selector);const element=document.querySelector(selector);if(params.hasOwnProperty("waitTime")){setTimeout(function(){if(!stopFlg)modal.show()},params.waitTime)} if(params.hasOwnProperty("closeElement")){const $closeElement=params.closeElement;$closeElement.on("click",function(e){modal.hide()})} if(params.hasOwnProperty("showOnVisible")&&params.showOnVisible){let hidden,visibilityChange;let flag=!1;if(typeof document.hidden!=="undefined"){hidden="hidden";visibilityChange="visibilitychange"}else if(typeof document.mozHidden!=="undefined"){hidden="mozHidden";visibilityChange="mozvisibilitychange"}else if(typeof document.msHidden!=="undefined"){hidden="msHidden";visibilityChange="msvisibilitychange"}else if(typeof document.webkitHidden!=="undefined"){hidden="webkitHidden";visibilityChange="webkitvisibilitychange"} document.addEventListener(visibilityChange,function(){if(document.hidden){flag=!0}else if(flag){flag=!1;if(!stopFlg)modal.show()}},!1)} if(params.hasOwnProperty("showOnEscape")&&params.showOnEscape){$("body").on("mouseleave",function(){if(!stopFlg)modal.show()})} if(params.hasOwnProperty("transfer")){const transfer=params.transfer;if(transfer.hasOwnProperty("wait")&&transfer.hasOwnProperty("url")&&transfer.url!==""){setTimeout(function(){location.href=transfer.url},transfer.wait)}} if(params.hasOwnProperty("showOnScroll")&&params.showOnScroll){let isShow=!1;const popup=()=>{element.addEventListener("hidden.bs.modal",(event)=>{isShow=!1});if(!isShow){modal.show();isShow=!0}};let currentPos=0;const threshold=params.hasOwnProperty("threshold")?params.threshold:300;let onceTop=!1;let onceBottom=!1;const scrollHeight=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);const pageMostBottom=scrollHeight-window.innerHeight-threshold;$(window).on("scroll",function(){const scrollTop=$(this).scrollTop();if(scrollTop<=threshold){if(scrollTop<currentPos){onceTop=!1}}else if(threshold<scrollTop&&scrollTop<pageMostBottom){if(scrollTop<currentPos){onceBottom=!1}else{if(!onceTop){popup();onceTop=!onceTop}}}else{if(currentPos<scrollTop){if(!onceBottom){popup();onceBottom=!onceBottom}}} currentPos=scrollTop})}} static init_youtube(){const ytData=Array.from($("[data-video-id]")).map((e)=>$(e).data("video-id"));const ytPlayer=[];let player;const ytEvent={onReady:function(event){ytPlayer[ytPlayer.length]=event.target},};const tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";const firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);function onYouTubeIframeAPIReadyLazyLoad(id){const data=ytData.filter(function(value){return value==id});player=new YT.Player(data[0],{height:360,width:640,videoId:data[0],events:ytEvent,})} document.addEventListener("lazybeforeunveil",function(e){const childElementId=e.target.firstElementChild.id;onYouTubeIframeAPIReadyLazyLoad(childElementId)})}} Util.init()})