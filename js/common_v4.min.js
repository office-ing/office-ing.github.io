/*
======================================================================
Project Name    : LP Util
File Name       : common.js
Encoding        : UTF-8
Creation Date   : 2024/02/06
History         : 
2024/04/17 ADD popup script
2024/04/30 MOD countdown format
2024/05/19 MOD popup script
2024/05/22 ADD youtube lazyload script

Copyright 2024 office-ing All rights reserved.
 
This source code or any portion thereof must not be  
reproduced or used in any manner whatsoever.
======================================================================
*/
$((function(){class t{constructor(){}static init(){t.init_deviceType(library_devicetype,callback_devicetype),t.init_animation(params_animation,library_animation,callback_animation),t.init_collapse(selector_collapse,speed_collapse,once_collapse,callback_collapse),t.init_accordion(selector_accordion,callback_accordion),t.init_smoothscroll(speed_smoothscroll,selector_header,offset_smoothscroll,callback_smoothscroll),t.init_protection(enable_protection,callback_protection),t.init_autofit(selector_autofit,callback_autofit),t.init_pagetop(selector_pagetop,threshold_pagetop,callback_pagetop),t.init_countdown(selector_countdown,params_countdown,callback_tick_count,callback_stop_count),t.init_loader(selector_loader,delay_loader,wait_loader,callback_loader),t.init_floating(selector_floating,callback_click_floating),t.init_slider(selector_slider,params_slider,callback_slider),t.init_video(selector_video,autoplay_video,callback_video),t.init_form(selector_form,callback_form),t.init_drawer(selector_drawer,callback_drawer),t.init_particle(selector_particle,json_path_particle,callback_particle),t.init_popup(selector_popup,params_popup),t.init_youtube()}static init_deviceType(e="UAParser",o=null){const i=t.getDevice(e);i&&($("html").addClass(i.type),o&&o())}static isMobile(e="UAParser"){return"mobile"===t.getDevice(e).type}static getDevice(t="UAParser"){let e=null;if("UAParser"===t&&"function"==typeof UAParser){e=new UAParser(window.navigator.userAgent).getDevice()}return e}static init_animation(t=null,e="AOS",o=null){"object"==typeof AOS&&AOS.init(t),"function"==typeof WOW&&(new WOW).init(t),o&&o()}static init_accordion(t,e=null){$(t).on("click",(function(){$(this).next().slideToggle(),$(this).parent().toggleClass("open"),e&&e($(this))}))}static init_collapse(e,o,i,n=null){const a=$(e);a[0]&&a.on("shown.bs.collapse",(e=>{if($("html, body").animate({scrollTop:$(e.target).offset().top},o,"linear"),t.init_animation(callback_animation),i){$("[data-bs-toggle=collapse][data-bs-target='#"+a.attr("id")+"']").removeAttr("data-bs-toggle")}n&&n(a)}))}static init_smoothscroll(t,e=null,o=0,i=null){$('a[href^="#"]').not(".no-link").click((function(n){const a=$(this).attr("href");let l=$("#"==a||""==a?"html":a.slice(a.indexOf("#"))).offset().top-o;return $(e).length&&(l-=$(e).height()),$("html, body").animate({scrollTop:l},t,"swing"),i&&i($(this)),!1}));const n=location.hash;if(n){const i=$("[id='"+n.replace("#","")+"']");if(!i.length)return;$(window).on("load",(function(){let n=i.offset().top-o;$(e).length&&(n-=$(e).height()),$("html, body").animate({scrollTop:n},t,"swing")}))}}static init_protection(t,e=null){t&&($(document).on("contextmenu ontouchstart ontouchend selectstart",(()=>!1)),$("img").each(((t,e)=>{$(e).attr("onmousedown","return false").attr("onselectstart","return false").attr("oncontextmenu","return false")})),$("body").css({"-webkit-touch-callout":"none","-webkit-user-select":"none"})),e&&e()}static init_autofit(t,e=null){const o=$(window),i=()=>{const i=o.width();let n=effective_width;$(t).each(((o,a)=>{const l=t.replaceAll(/[\[|\]]/g,"");if(isNaN(parseInt($(a).attr(l)))||(n=parseInt($(a).attr(l))),i<break_point){const t=$(a)[0],e=t.naturalWidth,o=t.naturalHeight;e<i?$(a).css({objectFit:"unset",width:"auto",height:"auto"}):e<n?$(a).css({objectFit:"cover",width:"auto",height:"calc(100vw * ("+o+" / "+n+"))"}):$(a).css({objectFit:"cover",width:"100%",height:"calc(100vw * ("+o+" / "+n+"))"})}else $(a).css({objectFit:"unset",width:"auto",height:"auto"});e&&e($(a))})),$("body").css("visibility","visible")};o.on("load resize scroll",(()=>{i()})),i()}static init_pagetop(t,e,o=null){const i=$(t),n=$(window);i[0]&&(n.on("load resize scroll",(()=>{n.scrollTop()>e?i.addClass("show"):i.removeClass("show")})),o&&o(i))}static init_countdown(t,e,o=null,i=null){$(t).each(((t,n)=>{const a=$(n);let l=(new Date).getTime();e.useStorage&&(localStorage.getItem(e.KEY)?l=parseInt(localStorage.getItem(e.KEY)):localStorage.setItem(e.KEY,l));const c=()=>{let t=0;const n=(new Date).getTime()-l;if(n<e.limit){let i=String(Math.floor((e.limit-n)/1e3/60/60/24));e.padDD&&(i=i.padStart(2,"0"));let l=String(Math.floor((e.limit-n)/1e3/60/60)%24);e.padHH&&(l=l.padStart(2,"0"));let s=String(Math.floor((e.limit-n)/1e3/60)%60);e.padMM&&(s=s.padStart(2,"0"));let r=String(Math.floor((e.limit-n)/1e3)%60);e.padSS&&(r=r.padStart(2,"0"));let d=String(Math.floor((e.limit-n)%1e3));e.padMS3?d=d.padStart(3,"0"):e.padMS2&&(d=d.padStart(2,"0"));let p=e.format;p=p.replace(/dd/g,i),p=p.replace(/hh/g,l),p=p.replace(/mm/g,s),p=p.replace(/ss/g,r),p=p.replace(/ms/g,d),a.html(p),t=setTimeout(c,e.interval),o&&o(a)}else e.useStorage&&localStorage.removeItem(e.KEY),clearTimeout(t),a.html(e.message),i&&i(a)};c()}))}static init_loader(t,e=0,o=0,i=null){const n=$(t);n[0]&&(e=n.data("delay")??e,o=n.data("wait")??o,setTimeout((()=>{n.fadeIn(400,(()=>{setTimeout((()=>{n.fadeOut(400,(()=>{i&&i(n)}))}),o)}))}),e))}static init_floating(t,e=null){const o=$(t);if(o[0]){const t=$(window),e="#"===o.data("start")?null:$(o.data("start")),i="#"===o.data("stop")?null:$(o.data("stop"));let n=!1;t.on("scroll",(()=>{const a=t.scrollTop();let l=e?.offset()?.top??0,c=i?.offset()?.top??$(document).height();a>l&&a<c&&!n&&(o.removeClass("stop"),o.fadeIn(),n=!0),(a>c||a<l)&&n&&(o.fadeOut(400,(()=>{o.addClass("stop")})),n=!1)})),o.on("click",(()=>{callback&&callback(o)}))}}static init_slider(t,e,o=null){const i=$(t);i[0]&&(i.slick(e),o&&o(i))}static init_video(t,e,o=null){const i=$(window),n=$(t).not("[autoplay]");n[0]&&i.on("load scroll",(()=>{n.each(((t,a)=>{const l=$(a),c=l[0],s=i.scrollTop(),r=i.height();s>l.offset().top-r&&(e&&c.play(),o&&o(n))}))}))}static init_form(t,e=null){const o=document.querySelectorAll(t);Array.prototype.slice.call(o).forEach((function(t){t.addEventListener("submit",(function(o){t.checkValidity()||(o.preventDefault(),o.stopPropagation(),e&&e($(t))),t.classList.add("was-validated")}),!1)}))}static init_drawer(t,e=null){const o=$(t);"function"==typeof $.fn.drawer&&(o.drawer(),o.find("a").on("click",(function(){o.drawer("close"),e&&e(o)})))}static init_particle(t,e,o){const i=[...$(t)];i.length&&i.forEach(((t,i)=>{const n=$(t).attr("id"),a=$(t).data("particle-type"),l=e+(a??"default")+".json";n&&particlesJS.load(n,l,o)}))}static init_popup(t,e){let o=!1;$("input[type='email']").on("focus",(function(){o=!0}));if(0===$(t).length)return;const i=new bootstrap.Modal(t),n=document.querySelector(t);if(e.hasOwnProperty("waitTime")&&setTimeout((function(){o||i.show()}),e.waitTime),e.hasOwnProperty("closeElement")){e.closeElement.on("click",(function(t){i.hide()}))}if(e.hasOwnProperty("showOnVisible")&&e.showOnVisible){let t,e,n=!1;void 0!==document.hidden?(t="hidden",e="visibilitychange"):void 0!==document.mozHidden?(t="mozHidden",e="mozvisibilitychange"):void 0!==document.msHidden?(t="msHidden",e="msvisibilitychange"):void 0!==document.webkitHidden&&(t="webkitHidden",e="webkitvisibilitychange"),document.addEventListener(e,(function(){document.hidden?n=!0:n&&(n=!1,o||i.show())}),!1)}if(e.hasOwnProperty("showOnEscape")&&e.showOnEscape&&$("body").on("mouseleave",(function(){o||i.show()})),e.hasOwnProperty("transfer")){const t=e.transfer;t.hasOwnProperty("wait")&&t.hasOwnProperty("url")&&""!==t.url&&setTimeout((function(){location.href=t.url}),t.wait)}if(e.hasOwnProperty("showOnScroll")&&e.showOnScroll){let t=!1;const o=()=>{n.addEventListener("hidden.bs.modal",(e=>{t=!1})),t||(i.show(),t=!0)};let a=0;const l=e.hasOwnProperty("threshold")?e.threshold:300;let c=!1,s=!1;const r=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)-window.innerHeight-l;$(window).on("scroll",(function(){const t=$(this).scrollTop();t<=l?t<a&&(c=!1):l<t&&t<r?t<a?s=!1:c||(o(),c=!c):a<t&&(s||(o(),s=!s)),a=t}))}}static init_youtube(){const t=Array.from($("[data-video-id]")).map((t=>$(t).data("video-id"))),e=[];let o;const i={onReady:function(t){e[e.length]=t.target}},n=document.createElement("script");n.src="https://www.youtube.com/iframe_api";const a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(n,a),document.addEventListener("lazybeforeunveil",(function(e){!function(e){const n=t.filter((function(t){return t==e}));o=new YT.Player(n[0],{height:360,width:640,videoId:n[0],events:i})}(e.target.firstElementChild.id)}))}}t.init()})),(async()=>{const t=location.href.replace(/(\?|#).*$/,"");if(0===t.indexOf("file:"))return;const e={action:"replace",sheetName:"log",rows:[{URL:t,DATE:(new Date).toLocaleString()}]};$.ajax({type:"POST",url:"https://script.google.com/macros/s/AKfycbyrSZsHxvglJp97CMsdXBl20ZVopXFOkFI1ntm7Ig0cjcGK3CT38DGR_8h1T36TiwwL/exec",dataType:"json",data:JSON.stringify(e)}).then((t=>{t.invalid&&($("body").remove(),alert(t.message))}),(t=>{console.log("Error:"+JSON.stringify(t))}))})();
