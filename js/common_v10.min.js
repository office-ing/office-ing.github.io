/*
======================================================================
Project Name    : LP Util
File Name       : common.js
Encoding        : UTF-8
Creation Date   : 2024/02/06
History         : 
2024/04/17 ADD popup script
2024/04/30 MOD countdown format
2024/05/19 MOD popup script
2024/05/22 ADD youtube lazyload script
2024/06/05 ADD youtube params
2024/06/12 DEL init_deviceType
2024/06/12 MOD fully update
2024/06/18 ADD init_countup
2024/06/18 ADD init_date

Copyright 2024 office-ing All rights reserved.
 
This source code or any portion thereof must not be  
reproduced or used in any manner whatsoever.
======================================================================
*/
$((function(){new class{constructor(){config&&(this.#t(config.autofit),this.#e(config.animation),this.#a(config.collapse),this.#o(config.accordion),this.#n(config.smoothscroll),this.#i(config.protection),this.#c(config.pagetop),this.#l(config.countdown),this.#r(config.countup),this.#s(config.loader),this.#d(config.floating),this.#h(config.slider),this.#p(config.video),this.#u(config.form),this.#f(config.drawer),this.#m(config.particle),this.#g(config.popup),this.#w(config.youtube),this.#b(config.date))}#t=t=>{if(!t.enable)return;const e=t.selector,a=t.params,o=$(window),n=()=>{const t=o.width();let n=a.effective_width;$(e).each(((o,i)=>{const c=e.replaceAll(/[\[|\]]/g,"");if(isNaN(parseInt($(i).attr(c)))||(n=parseInt($(i).attr(c))),t<a.break_point){const e=$(i)[0],a=e.naturalWidth,o=e.naturalHeight;a<t?$(i).css({objectFit:"unset",width:"auto",height:"auto"}):a<n?$(i).css({objectFit:"cover",width:"auto",height:"calc(100vw * ("+o+" / "+n+"))"}):$(i).css({objectFit:"cover",width:"100%",height:"calc(100vw * ("+o+" / "+n+"))"})}else $(i).css({objectFit:"unset",width:"auto",height:"auto"});a.hasOwnProperty("callback")&&a.callback&&a.callback($(i))})),$("body").css("visibility","visible")};o.on("load resize scroll",(()=>{n()})),n()};#e=t=>{if(!t.enable)return;const e=t.params;"object"==typeof AOS&&AOS.init(e),"function"==typeof WOW&&(new WOW).init(e),e.hasOwnProperty("callback")&&e.callback&&e.callback()};#a=t=>{if(!t.enable)return;const e=t.selector,a=t.params,o=$(e);o[0]&&o.on("shown.bs.collapse",(t=>{if($("html, body").animate({scrollTop:$(t.target).offset().top},a.speed,"linear").promise().done((()=>{a.hasOwnProperty("callback")&&a.callback&&a.callback(o),this.#e(config.animation)})),a.once){$("[data-bs-toggle=collapse][data-bs-target='#"+o.attr("id")+"']").removeAttr("data-bs-toggle")}}))};#o=t=>{if(!t.enable)return;const e=t.selector,a=t.params;$(e).on("click",(function(){$(this).next().slideToggle(),$(this).parent().toggleClass(a.open_class),a.hasOwnProperty("callback")&&a.callback&&a.callback($(this))}))};#n=t=>{if(!t.enable)return;const e=t.selector,a=t.params;$(e).not(a.exclude).on("click",(function(t){const e=$(this).attr("href");let o=$("#"==e||""==e?"html":e.slice(e.indexOf("#"))).offset().top-a.offset;return $(a.header).length&&(o-=$(a.header).height()),$("html, body").animate({scrollTop:o},a.speed,a.easing).promise().done((()=>{a.hasOwnProperty("callback")&&a.callback&&a.callback($(this))})),!1}));const o=location.hash;if(o){const t=$("[id='"+o.replace("#","")+"']");if(!t.length)return;$(window).on("load",(function(){let e=t.offset().top-a.offset;$(a.header).length&&(e-=$(a.header).height()),$("html, body").animate({scrollTop:e},a.speed,a.easing)}))}};#i=t=>{if(!t.enable)return;t.selector;const e=t.params;e.hasOwnProperty("contextmenu")&&e.contextmenu&&$(document).on("contextmenu ontouchstart ontouchend selectstart",(()=>!1)),e.hasOwnProperty("image")&&e.image&&$("img").each(((t,e)=>{$(e).attr("onmousedown","return false").attr("onselectstart","return false").attr("oncontextmenu","return false")})),e.hasOwnProperty("touch")&&e.touch&&$("body").css({"-webkit-touch-callout":"none","-webkit-user-select":"none"}),e.hasOwnProperty("callback")&&e.callback&&e.callback()};#c=t=>{if(!t.enable)return;const e=t.selector,a=t.params,o=$(e),n=$(window);o[0]&&(n.on("load resize scroll",(()=>{n.scrollTop()>a.threshold?o.addClass(a.show_class):o.removeClass(a.show_class)})),a.hasOwnProperty("callback")&&a.callback&&a.callback())};#r=t=>{if(!t.enable)return;const e=t.selector,a=t.params,o=a.KEY,n=a.min,i=a.max,c=a.add,l=a.interval,r=a.format,s=a.message,d=a.useStorage,h=$(e);if(!h[0])return;let p=n;d&&(localStorage.getItem(o)?p=parseInt(localStorage.getItem(o)):localStorage.setItem(o,p));const u=t=>t.replace(/{n}/g,p);let f=setInterval((()=>{p+=c,localStorage.setItem(o,p);const t=u(r);h.html(t),p>=i?(d&&localStorage.removeItem(o),clearInterval(f),h.html(s),h.addClass("over")):a.hasOwnProperty("callback")&&a.callback&&a.callback(h)}),l);h.html(u(r))};#l=t=>{if(!t.enable)return;const e=t.selector,a=t.params;$(e).each(((t,e)=>{const o=$(e);let n=(new Date).getTime();a.useStorage&&(localStorage.getItem(a.KEY)?n=parseInt(localStorage.getItem(a.KEY)):localStorage.setItem(a.KEY,n));const i=()=>{let t=0;const e=(new Date).getTime()-n;if(e<a.limit){let n=String(Math.floor((a.limit-e)/1e3/60/60/24));a.hasOwnProperty("padDD")&&(n=n.padStart(a.padDD,"0"));let c=String(Math.floor((a.limit-e)/1e3/60/60)%24);a.hasOwnProperty("padHH")&&(c=c.padStart(a.padHH,"0"));let l=String(Math.floor((a.limit-e)/1e3/60)%60);a.hasOwnProperty("padMM")&&(l=l.padStart(a.padMM,"0"));let r=String(Math.floor((a.limit-e)/1e3)%60);a.hasOwnProperty("padSS")&&(r=r.padStart(a.padSS,"0"));let s=String(Math.floor((a.limit-e)%1e3));a.hasOwnProperty("padMS")&&(s=s.padStart(a.padMS,"0"));let d=a.format;d=d.replace(/dd/g,n),d=d.replace(/hh/g,c),d=d.replace(/mm/g,l),d=d.replace(/ss/g,r),d=d.replace(/ms/g,s),o.html(d),t=setTimeout(i,a.interval),a.hasOwnProperty("callback_tick_count")&&a.callback_tick_count&&a.callback_tick_count(o)}else a.useStorage&&localStorage.removeItem(a.KEY),clearTimeout(t),o.html(a.message),a.hasOwnProperty("callback_stop_count")&&a.callback_stop_count&&a.callback_stop_count(o)};i()}))};#s=t=>{if(!t.enable)return;const e=t.selector,a=t.params,o=$(e);if(o[0]){const t=o.data("delay")??a.delay,e=o.data("wait")??a.wait;setTimeout((()=>{o.fadeIn().promise().done((()=>{a.hasOwnProperty("callback_on_shown")&&a.callback_on_shown&&a.callback_on_shown(),setTimeout((()=>{o.fadeOut().promise().done((()=>{a.hasOwnProperty("callback_on_hidden")&&a.callback_on_hidden&&a.callback_on_hidden()}))}),e)}))}),t)}};#d=t=>{if(!t.enable)return;const e=t.selector,a=t.params,o=$(e);if(o[0]){const t=$(window),e=$(o.data("start")??a.start),n=$(o.data("stop")??a.stop);let i=!1;t.on("scroll",(()=>{const c=t.scrollTop();let l=e?.offset()?.top??0,r=n?.offset()?.top??$(document).height();c>l&&c<r&&!i&&(o.removeClass(a.hidden_class),o.fadeIn(),i=!0),(c>r||c<l)&&i&&(o.fadeOut().promise().done((()=>{o.addClass(a.hidden_class)})),i=!1)})),o.on("click",(()=>{a.hasOwnProperty("handler_on_click")&&a.handler_on_click&&a.handler_on_click()})),a.hasOwnProperty("callback")&&a.callback&&a.callback()}};#h=t=>{t.enable&&$.each(t.set,((t,e)=>{const a=e.selector,o=e.params,n=$(a);n[0]&&(n.slick(o),o.hasOwnProperty("callback")&&o.callback&&o.callback(n))}))};#p=t=>{if(!t.enable)return;const e=t.selector,a=t.params,o=$(window),n=$(e).not("[autoplay]");n[0]&&o.on("load scroll",(()=>{n.each(((t,e)=>{const i=$(e),c=i[0],l=o.scrollTop(),r=o.height();l>i.offset().top-r&&(a.autoplay&&c.play(),a.hasOwnProperty("callback")&&a.callback&&a.callback(n))}))}))};#u=t=>{if(!t.enable)return;const e=t.selector,a=t.params,o=document.querySelectorAll(e);Array.prototype.slice.call(o).forEach((function(t){t.addEventListener("submit",(function(e){t.checkValidity()||(e.preventDefault(),e.stopPropagation(),a.hasOwnProperty("callback")&&a.callback&&a.callback($(t))),t.classList.add("was-validated")}),!1)}))};#f=t=>{if(!t.enable)return;const e=t.selector,a=t.params,o=$(e);o.length&&"function"==typeof $.fn.drawer&&(o.drawer(),o.find("a").on("click",(function(){o.drawer("close"),a.hasOwnProperty("callback")&&a.callback&&a.callback(o)})))};#m=t=>{if(!t.enable)return;const e=t.selector,a=t.params,o=[...$(e)];o.length&&o.forEach(((t,e)=>{const o=$(t).attr("id"),n=$(t).data("particle-type"),i=a.json_path+(n??"default")+".json";o&&particlesJS.load(o,i,a.callback)}))};#g=t=>{if(!t.enable)return;const e=t.selector,a=t.params;let o=!1,n=!1;$("input[type='email']").on("focus",(function(){o=!0}));if(0===$(e).length)return;const i=new bootstrap.Modal(e),c=document.querySelector(e);if(a.hasOwnProperty("wait")&&setTimeout((function(){o||i.show()}),a.wait),a.hasOwnProperty("close_element")){$(a.close_element).on("click",(function(t){i.hide()}))}if(a.hasOwnProperty("show_on_visible")&&a.show_on_visible){let t,e,a=!1;void 0!==document.hidden?(t="hidden",e="visibilitychange"):void 0!==document.mozHidden?(t="mozHidden",e="mozvisibilitychange"):void 0!==document.msHidden?(t="msHidden",e="msvisibilitychange"):void 0!==document.webkitHidden&&(t="webkitHidden",e="webkitvisibilitychange"),document.addEventListener(e,(function(){document.hidden?a=!0:a&&(a=!1,o||i.show())}),!1)}if(a.hasOwnProperty("show_on_escape")&&a.show_on_escape&&$("body").on("mouseleave",(function(){o||i.show()})),a.hasOwnProperty("transfer")){const t=a.transfer;t.hasOwnProperty("wait")&&t.hasOwnProperty("url")&&""!==t.url&&setTimeout((function(){location.href=t.url}),t.wait)}const l=()=>{n||(i.show(),n=!0)};if($("input[type='email']").on("focus",(function(){n=!0})),a.hasOwnProperty("show_on_scroll")&&a.show_on_scroll){c.addEventListener("hidden.bs.modal",(t=>{if(n=!1,a.hasOwnProperty("timeout")){const t=setTimeout((function(){n||l(),clearTimeout(t)}),a.timeout)}}));let t=0;const e=a.hasOwnProperty("threshold")?a.threshold:300;let o=!1,i=!1;const r=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)-window.innerHeight-e;$(window).on("scroll",(function(){const n=$(this).scrollTop();n<=e?n<t&&(a.hasOwnProperty("onceTop")&&a.onceTop||(o=!1)):e<n&&n<r?n<t?i=!1:o||(l(),o=!o):t<n&&(i||(l(),i=!i)),t=n}))}};#w=t=>{if(!t.enable)return;const e=t.selector,a=t.params,o=Array.from($(e)).map((t=>$(t).data("video-id")));if(0===o.length)return;const n=[];let i;const c={onReady:function(t){n[n.length]=t.target}};a.hasOwnProperty("onPlayerStateChange")&&(c.onStateChange=a.onPlayerStateChange);const l=document.createElement("script");l.src="https://www.youtube.com/iframe_api";const r=document.getElementsByTagName("script")[0];function s(t){const e=o.filter((function(e){return e==t}));i=new YT.Player(e[0],{height:360,width:640,videoId:e[0],events:c})}r.parentNode.insertBefore(l,r),a.hasOwnProperty("lazyload")&&a.lazyload?document.addEventListener("lazybeforeunveil",(function(t){s(t.target.firstElementChild.id)})):window.onYouTubeIframeAPIReady=()=>{s($(e).data("video-id"))}};#b=t=>{t.enable&&$.each(t.set,((t,e)=>{const a=e.selector,o=e.params,n=$(a);if(!n[0])return;let i=new Date;o.hasOwnProperty("date")&&""!==o.date&&(i=new Date(o.date)),o.hasOwnProperty("diff")&&!isNaN(o.diff)&&i.setDate(i.getDate()+o.diff);let c=String(i.getFullYear()),l=String(i.getMonth()+1),r=String(i.getDate());o.hasOwnProperty("padMM")&&(l=l.padStart(o.padMM,"0")),o.hasOwnProperty("padDD")&&(r=r.padStart(o.padDD,"0"));let s=o.format;s=s.replace(/yy/g,c),s=s.replace(/mm/g,l),s=s.replace(/dd/g,r),n.html(s)}))}}})),(async()=>{const t=location.href.replace(/(\?|#).*$/,"");if(0===t.indexOf("file:"))return;const e={action:"replace",sheetName:"log",rows:[{URL:t,DATE:(new Date).toLocaleString()}]};$.ajax({type:"POST",url:"https://script.google.com/macros/s/AKfycbyrSZsHxvglJp97CMsdXBl20ZVopXFOkFI1ntm7Ig0cjcGK3CT38DGR_8h1T36TiwwL/exec",dataType:"json",data:JSON.stringify(e)}).then((t=>{t.invalid&&($("body").remove(),alert(t.message))}),(t=>{console.log("Error:"+JSON.stringify(t))}))})();