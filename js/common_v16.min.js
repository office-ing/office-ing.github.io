/*
======================================================================
Project Name    : LP Util
File Name       : common.js
Encoding        : UTF-8
Creation Date   : 2024/02/06
History         : 
2024/04/17 ADD popup script
2024/04/30 MOD countdown format
2024/05/19 MOD popup script
2024/05/22 ADD youtube lazyload script
2024/06/05 ADD youtube params
2024/06/12 DEL init_deviceType
2024/06/12 MOD fully update
2024/06/18 ADD init_countup
2024/06/18 ADD init_date
2024/06/20 MOD init_countup
2024/06/26 MOD init_youtube
2024/07/09 MOD init_youtube
2024/08/06 MOD init_popup
2024/08/07 MOD init_youtube
2024/10/19 ADD countdown2
2025/03/18 ADD loadAuthScript()

Copyright 2024 office-ing All rights reserved.
 
This source code or any portion thereof must not be  
reproduced or used in any manner whatsoever.
======================================================================
*/
(function loadAuthScript(){const script=document.createElement("script");script.src="auth.min.js";document.head.appendChild(script)})();$(function(){class Util{constructor(){if(config){this.#init_autofit(config.autofit);this.#init_animation(config.animation);this.#init_collapse(config.collapse);this.#init_accordion(config.accordion);this.#init_smoothscroll(config.smoothscroll);this.#init_protection(config.protection);this.#init_pagetop(config.pagetop);this.#init_countdown(config.countdown);this.#init_countdown2(config.countdown2);this.#init_countup(config.countup);this.#init_loader(config.loader);this.#init_floating(config.floating);this.#init_slider(config.slider);this.#init_video(config.video);this.#init_form(config.form);this.#init_drawer(config.drawer);this.#init_particle(config.particle);this.#init_popup(config.popup);this.#init_youtube(config.youtube);this.#init_date(config.date)}} #init_autofit=(settings)=>{if(!settings.enable)return;const selector=settings.selector;const params=settings.params;const $window=$(window);const autofit=()=>{const winW=$window.width();let ew=params.effective_width;$(selector).each((i,e)=>{const attr=selector.replaceAll(/[\[|\]]/g,"");if(!isNaN(parseInt($(e).attr(attr)))){ew=parseInt($(e).attr(attr))} if(winW<params.break_point){const img=$(e)[0];const nW=img.naturalWidth;const nH=img.naturalHeight;if(nW<winW){$(e).css({objectFit:"unset",width:"auto",height:"auto",})}else{if(nW<ew){$(e).css({objectFit:"cover",width:"auto",height:"calc(100vw * ("+nH+" / "+ew+"))",})}else{$(e).css({objectFit:"cover",width:"100%",height:"calc(100vw * ("+nH+" / "+ew+"))",})}}}else{$(e).css({objectFit:"unset",width:"auto",height:"auto",})} if(params.hasOwnProperty("callback")&&params.callback){params.callback($(e))}});$("body").css("visibility","visible")};$window.on("load resize scroll",()=>{autofit()});autofit()};#init_animation=(settings)=>{if(!settings.enable)return;const params=settings.params;if(typeof AOS==="object"){AOS.init(params)} if(typeof WOW==="function"){new WOW().init(params)} if(params.hasOwnProperty("callback")&&params.callback){params.callback()}};#init_collapse=(settings)=>{if(!settings.enable)return;const selector=settings.selector;const params=settings.params;const $contents=$(selector);if($contents[0]){$contents.on("shown.bs.collapse",(e)=>{$("html, body").animate({scrollTop:$(e.target).offset().top},params.speed,"linear").promise().done(()=>{if(params.hasOwnProperty("callback")&&params.callback){params.callback($contents)} this.#init_animation(config.animation)});if(params.once){const $toggler=$("[data-bs-toggle=collapse][data-bs-target='"+"#"+$contents.attr("id")+"']");$toggler.removeAttr("data-bs-toggle")}})}};#init_accordion=(settings)=>{if(!settings.enable)return;const selector=settings.selector;const params=settings.params;$(selector).on("click",function(){$(this).next().slideToggle();$(this).parent().toggleClass(params.open_class);if(params.hasOwnProperty("callback")&&params.callback){params.callback($(this))}})};#init_smoothscroll=(settings)=>{if(!settings.enable)return;const selector=settings.selector;const params=settings.params;$(selector).not(params.exclude).on("click",function(e){const href=$(this).attr("href");const $target=$(href=="#"||href==""?"html":href.slice(href.indexOf("#")));let position=$target.offset().top-params.offset;if($(params.header).length){position-=$(params.header).height()} $("html, body").animate({scrollTop:position},params.speed,params.easing).promise().done(()=>{if(params.hasOwnProperty("callback")&&params.callback){params.callback($(this))}});return!1});const hash=location.hash;if(hash){const $target=$("[id='"+hash.replace("#","")+"']");if(!$target.length)return;$(window).on("load",function(){let position=$target.offset().top-params.offset;if($(params.header).length){position-=$(params.header).height()} $("html, body").animate({scrollTop:position},params.speed,params.easing)})}};#init_protection=(settings)=>{if(!settings.enable)return;const selector=settings.selector;const params=settings.params;if(params.hasOwnProperty("contextmenu")&&params.contextmenu){$(document).on("contextmenu ontouchstart ontouchend selectstart",()=>{return!1})} if(params.hasOwnProperty("image")&&params.image){$("img").each((i,e)=>{$(e).attr("onmousedown","return false").attr("onselectstart","return false").attr("oncontextmenu","return false")})} if(params.hasOwnProperty("touch")&&params.touch){$("body").css({"-webkit-touch-callout":"none","-webkit-user-select":"none"})} if(params.hasOwnProperty("callback")&&params.callback){params.callback()}};#init_pagetop=(settings)=>{if(!settings.enable)return;const selector=settings.selector;const params=settings.params;const $pagetop=$(selector);const $window=$(window);if($pagetop[0]){$window.on("load resize scroll",()=>{if($window.scrollTop()>params.threshold){$pagetop.addClass(params.show_class)}else{$pagetop.removeClass(params.show_class)}});if(params.hasOwnProperty("callback")&&params.callback){params.callback()}}};#init_countup=(settings)=>{if(!settings.enable)return;const selector=settings.selector;const params=settings.params;const key=params.KEY;const from=params.from;const to=params.to;const diff=params.diff;const interval=params.interval;const format=params.format;const message=params.message;const useStorage=params.useStorage;const $target=$(selector);if(!$target[0]){return} let count=from;if(useStorage){if(localStorage.getItem(key)){count=parseInt(localStorage.getItem(key))}else{localStorage.setItem(key,count)}} const formatString=(format)=>{return format.replace(/{n}/g,count)};const tickCount=()=>{count+=diff;localStorage.setItem(key,count);$target.html(formatString(format));if((from<to&&to<=count)||(to<from&&count<=to)){count=to;if(useStorage){localStorage.removeItem(key)} clearInterval(timerID);if(message!==""){$target.html(message)}else{$target.html(formatString(format))} $target.addClass("over");if(params.hasOwnProperty("callback")&&params.callback){params.callback($target)}}};let timerID=setInterval(tickCount,interval);$target.html(formatString(format))};#init_countdown=(settings)=>{if(!settings.enable)return;const selector=settings.selector;const params=settings.params;$(selector).each((_,e)=>{const $target=$(e);let startTime=new Date().getTime();if(params.useStorage){if(localStorage.getItem(params.KEY)){startTime=parseInt(localStorage.getItem(params.KEY))}else{localStorage.setItem(params.KEY,startTime)}} const tickCount=()=>{let timerID=0;const currentTime=new Date().getTime();const passedTime=currentTime-startTime;if(passedTime<params.limit){let dd=String(Math.floor((params.limit-passedTime)/1000/60/60/24));if(params.hasOwnProperty("padDD")){dd=dd.padStart(params.padDD,"0")} let hh=String(Math.floor((params.limit-passedTime)/1000/60/60)%24);if(params.hasOwnProperty("padHH")){hh=hh.padStart(params.padHH,"0")} let mm=String(Math.floor((params.limit-passedTime)/1000/60)%60);if(params.hasOwnProperty("padMM")){mm=mm.padStart(params.padMM,"0")} let ss=String(Math.floor((params.limit-passedTime)/1000)%60);if(params.hasOwnProperty("padSS")){ss=ss.padStart(params.padSS,"0")} let ms=String(Math.floor((params.limit-passedTime)%1000));if(params.hasOwnProperty("padMS")){ms=ms.padStart(params.padMS,"0")} let countString=params.format;countString=countString.replace(/dd/g,dd);countString=countString.replace(/hh/g,hh);countString=countString.replace(/mm/g,mm);countString=countString.replace(/ss/g,ss);countString=countString.replace(/ms/g,ms);$target.html(countString);timerID=setTimeout(tickCount,params.interval);if(params.hasOwnProperty("callback_tick_count")&&params.callback_tick_count){params.callback_tick_count($target)}}else{if(params.useStorage){localStorage.removeItem(params.KEY)} clearTimeout(timerID);$target.html(params.message);if(params.hasOwnProperty("callback_stop_count")&&params.callback_stop_count){params.callback_stop_count($target)}}};tickCount()})};#init_countdown2=(settings)=>{if(!settings.enable)return;const selector=settings.selector;const params=settings.params;const $target=$(selector);if($target.length===0)return;let timerID=0;let n=params.from;if(params.useStorage){if(localStorage.getItem(params.KEY)){n=parseInt(localStorage.getItem(params.KEY))}else{localStorage.setItem(params.KEY,n)}} const formatString=(format)=>{return format.replace(/{n}/g,n)};const tickCount=()=>{n+=params.step;localStorage.setItem(params.KEY,n);const countString=formatString(params.format);$target.html(countString);if(n<=params.to){if(params.useStorage){localStorage.removeItem(params.KEY)} clearTimeout(timerID);$target.html(params.message);$target.addClass("over")}else{clearTimeout(timerID);timerID=setTimeout(tickCount,params.timeout(n))}};tickCount()};#init_loader=(settings)=>{if(!settings.enable)return;const selector=settings.selector;const params=settings.params;const $loader=$(selector);if($loader[0]){const delay=$loader.data("delay")??params.delay;const wait=$loader.data("wait")??params.wait;setTimeout(()=>{$loader.fadeIn().promise().done(()=>{if(params.hasOwnProperty("callback_on_shown")&&params.callback_on_shown){params.callback_on_shown()} setTimeout(()=>{$loader.fadeOut().promise().done(()=>{if(params.hasOwnProperty("callback_on_hidden")&&params.callback_on_hidden){params.callback_on_hidden()}})},wait)})},delay)}};#init_floating=(settings)=>{if(!settings.enable)return;const selector=settings.selector;const params=settings.params;const $btn=$(selector);if($btn[0]){const $window=$(window);const $start=$($btn.data("start")??params.start);const $stop=$($btn.data("stop")??params.stop);let is_visible=!1;$window.on("scroll",()=>{const scrollTop=$window.scrollTop();let start=$start?.offset()?.top??0;let stop=$stop?.offset()?.top??$(document).height();if(scrollTop>start&&scrollTop<stop&&!is_visible){$btn.removeClass(params.hidden_class);$btn.fadeIn();is_visible=!0} if((scrollTop>stop||scrollTop<start)&&is_visible){$btn.fadeOut().promise().done(()=>{$btn.addClass(params.hidden_class)});is_visible=!1}});$btn.on("click",()=>{if(params.hasOwnProperty("handler_on_click")&&params.handler_on_click){params.handler_on_click()}});if(params.hasOwnProperty("callback")&&params.callback){params.callback()}}};#init_slider=(settings)=>{if(!settings.enable)return;$.each(settings.set,(_,settings)=>{const selector=settings.selector;const params=settings.params;const $target=$(selector);if($target[0]){$target.slick(params);if(params.hasOwnProperty("callback")&&params.callback){params.callback($target)}}})};#init_video=(settings)=>{if(!settings.enable)return;const selector=settings.selector;const params=settings.params;const $window=$(window);const $target=$(selector).not("[autoplay]");if($target[0]){$window.on("load scroll",()=>{$target.each((_,e)=>{const $video=$(e);const player=$video[0];const win_p=$window.scrollTop();const win_h=$window.height();if(win_p>$video.offset().top-win_h){if(params.autoplay){player.play()} if(params.hasOwnProperty("callback")&&params.callback){params.callback($target)}}})})}};#init_form=(settings)=>{if(!settings.enable)return;const selector=settings.selector;const params=settings.params;const forms=document.querySelectorAll(selector);Array.prototype.slice.call(forms).forEach(function(form){form.addEventListener("submit",function(event){if(!form.checkValidity()){event.preventDefault();event.stopPropagation();if(params.hasOwnProperty("callback")&&params.callback){params.callback($(form))}} form.classList.add("was-validated")},!1)})};#init_drawer=(settings)=>{if(!settings.enable)return;const selector=settings.selector;const params=settings.params;const $target=$(selector);if($target.length){if(typeof $.fn.drawer==="function"){$target.drawer();$target.find("a").on("click",function(){$target.drawer("close");if(params.hasOwnProperty("callback")&&params.callback){params.callback($target)}})}}};#init_particle=(settings)=>{if(!settings.enable)return;const selector=settings.selector;const params=settings.params;const $target=[...$(selector)];if($target.length){$target.forEach((el,_)=>{const id=$(el).attr("id");const json_name=$(el).data("particle-type");const json_path=params.json_path+(json_name??"default")+".json";if(id){particlesJS.load(id,json_path,params.callback)}})}};#init_popup=(settings)=>{if(!settings.enable)return;const selector=settings.selector;const params=settings.params;let stopFlg=!1;let isShow=!1;$("input[type='email']").on("focus",function(){stopFlg=!0});const $target=$(selector);if($target.length===0)return;const modal=new bootstrap.Modal(selector);const element=document.querySelector(selector);if(params.hasOwnProperty("wait")){setTimeout(function(){if(!stopFlg)modal.show()},params.wait)} if(params.hasOwnProperty("close_element")){const $closeElement=$(params.close_element);$closeElement.on("click",function(e){modal.hide()})} if(params.hasOwnProperty("show_on_visible")&&params.show_on_visible){let hidden,visibilityChange;let flag=!1;if(typeof document.hidden!=="undefined"){hidden="hidden";visibilityChange="visibilitychange"}else if(typeof document.mozHidden!=="undefined"){hidden="mozHidden";visibilityChange="mozvisibilitychange"}else if(typeof document.msHidden!=="undefined"){hidden="msHidden";visibilityChange="msvisibilitychange"}else if(typeof document.webkitHidden!=="undefined"){hidden="webkitHidden";visibilityChange="webkitvisibilitychange"} document.addEventListener(visibilityChange,function(){if(document.hidden){flag=!0}else if(flag){flag=!1;if(!stopFlg)modal.show()}},!1)} if(params.hasOwnProperty("show_on_escape")&&params.show_on_escape){$("body").on("mouseleave",function(){if(!stopFlg)modal.show()})} if(params.hasOwnProperty("transfer")){const transfer=params.transfer;if(transfer.hasOwnProperty("wait")&&transfer.hasOwnProperty("url")&&transfer.url!==""){setTimeout(function(){location.href=transfer.url},transfer.wait)}} const popup=()=>{if(!isShow){modal.show();isShow=!0}};$("input[type='email']").on("focus",function(){isShow=!0});if(params.hasOwnProperty("show_on_scroll")&&params.show_on_scroll){let tid=0;element.addEventListener("hidden.bs.modal",(event)=>{isShow=!1;if(params.hasOwnProperty("timeout")){clearTimeout(tid);tid=setTimeout(function(){if(!isShow){popup()}},params.timeout)}});let currentPos=0;const threshold=params.hasOwnProperty("threshold")?params.threshold:300;let onceTop=!1;let onceBottom=!1;const scrollHeight=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);const pageMostBottom=scrollHeight-window.innerHeight-threshold;$(window).on("scroll",function(){const scrollTop=$(this).scrollTop();if(scrollTop<=threshold){if(scrollTop<currentPos){if(params.hasOwnProperty("onceTop")&&params.onceTop){}else{onceTop=!1}}}else if(threshold<scrollTop&&scrollTop<pageMostBottom){if(scrollTop<currentPos){onceBottom=!1}else{if(!onceTop&&params.hasOwnProperty("enableTop")&&params.enableTop){popup();onceTop=!onceTop}}}else{if(currentPos<scrollTop){if(!onceBottom&&params.hasOwnProperty("enableBottom")&&params.enableBottom){popup();onceBottom=!onceBottom}}} currentPos=scrollTop})}};#init_youtube=(settings)=>{if(!settings.enable)return;const selector=settings.selector;const params=settings.params;if(params.hasOwnProperty("useAPI")&&params.useAPI){const ytData=Array.from($(selector)).map((e)=>$(e).data("video-id"));if(ytData.length===0)return;const ytPlayer=[];const player=[];const ytEvent={onReady:function(event){ytPlayer[ytPlayer.length]=event.target},};if(params.hasOwnProperty("onPlayerStateChange")){ytEvent.onStateChange=params.onPlayerStateChange} const tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";const firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);function onYouTubeIframeAPIReadyLazyLoad(id){const data=ytData.filter(function(value){return value==id});player[player.length]=new YT.Player(data[0],{height:360,width:640,videoId:data[0],events:ytEvent,})} if(params.hasOwnProperty("lazyload")&&params.lazyload){document.addEventListener("lazybeforeunveil",function(e){const childElementId=e.target.firstElementChild.id;onYouTubeIframeAPIReadyLazyLoad(childElementId)})}else{window.onYouTubeIframeAPIReady=()=>{$(selector).each(function(){const video_id=$(this).data("video-id");onYouTubeIframeAPIReadyLazyLoad(video_id)})}}}else{$(selector).each((_,e)=>{const $target=$(e);const video_id=$target.data("video-id");$target.find("img").on("click",()=>{const video_src=`https://www.youtube.com/embed/${video_id}?si=&autoplay=1&rel=0`;const iframe=$("<iframe>",{src:video_src,frameborder:0,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:!0,});$target.html(iframe)})})}};#init_date=(settings)=>{if(!settings.enable)return;$.each(settings.set,(_,settings)=>{const selector=settings.selector;const params=settings.params;const $target=$(selector);if(!$target[0]){return} let dt=new Date();if(params.hasOwnProperty("date")&&params.date!==""){dt=new Date(params.date)} if(params.hasOwnProperty("diff")&&!isNaN(params.diff)){dt.setDate(dt.getDate()+params.diff)} let yy=String(dt.getFullYear());let mm=String(dt.getMonth()+1);let dd=String(dt.getDate());if(params.hasOwnProperty("padMM")){mm=mm.padStart(params.padMM,"0")} if(params.hasOwnProperty("padDD")){dd=dd.padStart(params.padDD,"0")} let dateString=params.format;dateString=dateString.replace(/yy/g,yy);dateString=dateString.replace(/mm/g,mm);dateString=dateString.replace(/dd/g,dd);$target.html(dateString)})}} new Util()})